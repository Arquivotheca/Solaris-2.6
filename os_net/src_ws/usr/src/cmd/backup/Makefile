#
#ident  "@(#)Makefile 1.9     93/10/05 SMI"
#
# Copyright (c) 1993 by Sun Microsystems, Inc.
#
# cmd/backup/Makefile
#

include Makefile.backup

COMMONPRODSUBDIRS=	dump restore
UFSPRODSUBDIRS=
HSMPRODSUBDIRS=	 database dumpex fastfs operd recover
LIBSUBDIRS=	lib
LIBDONE=	$(LIBSUBDIRS)/.target_done
SUBDIRS=	$(LIBSUBDIRS) $(COMMONPRODSUBDIRS) $(UFSPRODSUBDIRS) \
		$(HSMPRODSUBDIRS)
UFSSUBDIRS=	$(LIBSUBDIRS) $(COMMONPRODSUBDIRS) $(UFSPRODSUBDIRS)
HSMSUBDIRS=	$(LIBSUBDIRS) $(COMMONPRODSUBDIRS) $(HSMPRODSUBDIRS)

UFSINSDIRS=	$(UFSROOTETC) $(UFSROOTUSR) $(UFSROOTUSRLIB) \
		$(UFSROOTUSRLIBFS) $(UFSROOTUSRSBIN)

HSMINSDIRS=	$(HSMROOTPKGLOC) $(HSMROOTPKGBIN) $(HSMROOTPKGLIB) \
		$(HSMROOTPKGSBIN) $(HSMVARPKGLOC) $(HSMVARPKGLOGLOC) \
		$(HSMETCPKGLOC)

.KEEP_STATE:

.DONE:
	@rm -f $(LIBDONE)

all: $(COMMONPRODSUBDIRS) $(UFSPRODSUBDIRS)

hsm debug: $(COMMONPRODSUBDIRS) $(HSMPRODSUBDIRS)

both:	all hsm

clean clobber lint: $(SUBDIRS) .DONE

install:	$(UFSINSDIRS) $(UFSSUBDIRS)

hsminstall:	$(HSMINSDIRS) $(HSMROOTPKGADMLINK) $(HSMROOTPKGETCLINK) \
		$(HSMSUBDIRS)

installboth:	install hsminstall

$(UFSINSDIRS) $(HSMINSDIRS):
	$(INS.dir)

$(COMMONPRODSUBDIRS) $(UFSPRODSUBDIRS) $(HSMPRODSUBDIRS): $(LIBSUBDIRS) FRC
	@$(DO_SUBDIR)

$(LIBSUBDIRS): FRC
	@if [ ! -f $(LIBDONE) ]; then \
		$(DO_SUBDIR); \
	fi
	@touch $(LIBDONE)

$(HSMROOTPKGADMLINK):
	-$(RM) $@; $(SYMLINK) $(ADMLINKVALUE) $(HSMROOTPKGADMLINK)

$(HSMROOTPKGETCLINK):
	-$(RM) $@; $(SYMLINK) $(ETCLINKVALUE) $(HSMROOTPKGETCLINK)

FRC:
