/*
 * Copyright (c) 1994, by Sun Microsystems, Inc.
 */

#ifndef	_SYS_MMU_H
#define	_SYS_MMU_H

#pragma ident	"@(#)mmu.h	1.3	95/07/31 SMI"

#ifdef	__cplusplus
extern "C" {
#endif

#ifndef _ASM
#define	good_addr(a)  (1) 		/* Can map all addresses */
#endif /* !_ASM */

/*
 * Definitions for the PowerPC MMU.
 *
 * The definitions are valid for 32bit implementation of PowerPC architecture.
 */

#if defined(_KERNEL) && !defined(_ASM)
/*
 * Table Search Descriptor Register 1 (SDR1).
 */
#ifdef _BIT_FIELDS_LTOH
struct sdr1 {
	unsigned sdr1_htabmask:9;
	unsigned sdr1_reserved:7;
	unsigned sdr1_htaborg:16;
};
#endif

#ifdef _BIT_FIELDS_HTOL
struct sdr1 {
	unsigned sdr1_htaborg:16;
	unsigned sdr1_reserved:7;
	unsigned sdr1_htabmask:9;
};
#endif

/*
 * Segment Register definition for memory segments.
 */
#ifdef _BIT_FIELDS_LTOH
struct segreg {
	unsigned segreg_vsid:24;	/* virtual segment id */
	unsigned segreg_reserved:5;
	unsigned segreg_ku:1;		/* key bit for user access */
	unsigned segreg_ks:1;		/* key bit for supervisor access */
	unsigned segreg_t:1;
};
#endif

#ifdef _BIT_FIELDS_HTOL
struct segreg {
	unsigned segreg_t:1;
	unsigned segreg_ks:1;		/* key bit for supervisor access */
	unsigned segreg_ku:1;		/* key bit for user access */
	unsigned segreg_reserved:5;
	unsigned segreg_vsid:24;	/* virtual segment id */
};
#endif

typedef union sreg {
	struct	segreg sr;
	u_int	sreg_uint;
} sreg_t;

/*
 * Low level mmu-specific functions
 */
int	valid_va_range(/* basep, lenp, minlen, dir */);

#endif /* defined(_KERNEL) && !defined(_ASM) */

/* bit masks for sdr1 */
#define	SDR1_HTABMASK		0x000001FF
#define	SDR1_HTABORG		0xFFFF0000

#define	SDR1_HTABORG_SHIFT	16

/* bit masks for segment register */
#define	SR_VSID	0x00FFFFFF
#define	SR_KU	0x20000000
#define	SR_KS	0x40000000
#define	SR_T	0x80000000

/* macro to create memory segment register value */
#define	MAKE_SR(v)	(((u_int)v & SR_VSID) | SR_KU)

#ifndef _ASM
/* functions in mmu.c */
extern void mmu_setpte(/* caddr_t base, struct pte pte */);
extern void mmu_getpte(/* caddr_t base, struct pte *ppte */);
extern void mmu_getkpte(/* caddr_t base, struct pte *ppte */);

/*
 * Cache geometry variables.
 */
extern int dcache_size;		/* size of data cache, in bytes */
extern int dcache_blocksize;	/* size of data cache block, in bytes */
extern int icache_size;		/* size of instruction cache, in bytes */
extern int icache_blocksize;	/* size of instruction cache block, in bytes */
extern int unified_cache;	/* non-zero if shared instruction/data cache */

#endif /* !_ASM */

#ifdef	__cplusplus
}
#endif

#endif /* !_SYS_MMU_H */
