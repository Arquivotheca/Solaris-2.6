#!/bin/sh
#
#	@(#)mksysent 1.8 95/12/20 SMI
#
#	mksysent - generate the sysent table from the list of system calls
#
nawk '
BEGIN {
	print "#include <sys/asm_linkage.h>"
	print "#include <sys/syscall.h>"
	print ""
	print "! This file is automatically generated from syscalls.list."
	print "! Do not edit by hand or your changes will be lost."
	print "! See mksysent and syscalls.list for details."
	print ""
	print "	.section	\".text\""
	print "	.align	4"
	print "sysent:"
}
/^#/	{ next; }		# ignore comment lines
{
	f = $1;
	if ($2 == "TRAP") {
		printf "! %s\n", f;
		printf "\trestore\t%%g0, SYS_%s, %%g1\n", f;
		printf "\tta\t8\n";
		printf "\tjmp\t%%g7\n";
		printf "\tnop\n";
	} else if ($2 == "SIMPLE") {
		printf "! %s\n", f;
		printf "\t.global\t%s\n", f;
		printf "\tcall\t%s\n", f;
		printf "\tnop\n";
		printf "\tb,a\ttrap0rtn\n";
		printf "\tnop\n";
	} else {
		printf "! %s\n", f;
		printf "\tb,a\tnosys\n";
		printf "\tnop\n";
		printf "\tnop\n";
		printf "\tnop\n";
	}
}
' <syscalls.list
